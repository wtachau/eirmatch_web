{% load staticfiles %}

<html>
<head>
<title> Spaces </title>

<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"> </script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="https://apis.google.com/js/client:plusone.js" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'js/popup.js' %}"></script>

<!-- Selectize jQuery library for tagging -->
<link rel="stylesheet" type="text/css" href="{% static 'css/tagging/selectize.css' %}">
<script type="text/javascript" src="{% static 'js/tagging/selectize.js' %}"></script>


<script type="text/javascript">

    function signinCallback(authResult) {
    	$("#logout").fadeIn(0001); 
    }
  </script>

</head>

<body>
	<div id="header">
		<div id="logo_full">
			<span id="logo_1">Originate</span>
			<span id="logo_2">SPACES</span>
		</div>
		<div class="upper_right" id="add_profile">
			<img src="{% static 'img/profile.png' %}">
		</div>
		<div class="upper_right" id="add_post">
			<img src="{% static 'img/plus.png' %}">
		</div>
	</div>

	<!-- begin post popup -->
	<div id="postPopup" class="popup"> 
		<div id="postPopupContent"> 
            <h2> Add Post </h2>
            <br>

            <form name="postForm" id="postForm" action="addPost" method="POST">
				<textarea name="short" id="short_description_popup" form="postForm" class="nonresize" placeholder="brief description"></textarea>
				<br><br>
				<!-- Tagging section. See http://brianreavis.github.io/selectize.js/ -->
				<h3>choose several tags</h3>
				<div id="tag-selector-wrapper">
				<select id="select-tag" name="tags" form="postForm" multiple placeholder="choose tags...">
				{% for tag in tags %}
					<option value={{tag.name}}>{{tag.name}}</option>
				{% endfor %}
				</select>
				</div>
				<script>
				$('#select-tag').selectize({
					maxItems: 5,
					delimiter: ',',
				    persist: false,
				    create: function(input) {
				        return {
				            value: input,
				            text: input
				        }
				    }
				});
				</script>	
				<!-- End of tagging section -->
				<br>	
				<h3>more details:</h3>	
				<textarea name="long" id="long_description_popup" form="postForm" class="nonresize" placeholder="more details"></textarea>
				<br/><br>
			
				{% csrf_token %}

				<input type="submit" value="Submit">
			</form>
        </div> 
    
    </div> 
   	<!-- end post popup -->

   	<!-- begin post popup -->
	<div id="profilePopup" class="popup"> 
		<div id="profilePopupContent"> 
            <h3> {{ user.name }} </p>
            <img id="profileImage" src={{ user.image }}?sz=200>
            <br><br>
            <!-- Update tags. See http://brianreavis.github.io/selectize.js/  -->
            <form name="updateTagsForm" id="updateTagsForm" action="updateTags" method="POST">
				<span>update your relevant tags</span>
				<div id="tag-updater-wrapper">
				<select id="select-tag-update" name="tags" form="updateTagsForm" multiple placeholder="choose tags...">
				{% for tag in tags %}
					<option value={{tag.name}} {% if tag.userRelevant %} selected {% endif %} >{{tag.name}}</option>
				{% endfor %}
				</select>
				</div>
				<script>
				$('#select-tag-update').selectize({
					delimiter: ',',
				    persist: false,
				    create: function(input) {
				        return {
				            value: input,
				            text: input
				        }
				    }
				});
				</script>
				{% csrf_token %}

				<input type="submit" value="Update">
			</form>
			<!-- End of tagging form -->

			<br><br>
            <span id="signinButton" style="display:none;">
	          <span 
	            class="g-signin"
	            data-callback="signinCallback"
	            data-clientid="1058509999201-n23gtmm967b4itcgdnjplr22l7ve7qb7.apps.googleusercontent.com"
	            data-cookiepolicy="single_host_origin"
	            data-requestvisibleactions=""
	            data-scope="openid email">
	          </span>
	        </span>
            <div id="logout" style="display:none;">sign out</div>
        </div> 
    
    </div> 
	<!-- <div class="loader"></div> ADD LOADING GIF HERE -->
   	<div id="backgroundPopup"></div>
   	<!-- end post popup -->

	<table id="body_table">
		<tr>
			<td id="left_panel"> 

				<!-- Relevant Posts -->

				<div class="section_header skills">
					<div>in your skill set</div>
				</div>
				<div class="left_section skills">
			        <div class="overflow_section" id="top_overflow">
			        	
			        	{% for post in relevant_posts %}

			        	<div id="ticket-{{post.id}}" onclick="showTicket('ticket-{{post.id}}');" class="ticket_box fade">
			        		<table>
				        		<tr>
					        		<td class="ticket_left_half">
						        		<img class="profilepic_small" src="{{ user.image }}"><br>
					        		</td>
					        		<td class="ticket_description">
					        			<span class="description">
					        				{{ post.short_description }}
					        			</span>
					        			<span class="hidden_description" style="display:none">
					        				{{post.long_description }}
					        			</span>
						        		<div class="tags">
						        			{% for tag in post.tagnames %}
						        			{{ tag }}
						        			{% endfor %}
						        		</div>
					        		</td>
					        		<td class="ticket_rightview">
					        			<img class="speechbubble" src="{% static 'img/speechbubble.png' %}">
					        			<div class="num_comments">
						        			{{ post.numComments }}
					        			</div>
					        		</td>
				        		</tr>
			        		</table>
			        	</div>

			        	{% endfor %}

			        </div>
				</div>

				<!-- All Posts -->

				<div class="section_header all">
				<div>most recent</div>
				</div>
				<div class="left_section skills">
			        <div class="overflow_section" id="top_overflow">
			        	
			        	{% for post in all_posts %}

			        	<div id="ticket-{{post.id}}" onclick="showTicket('ticket-{{post.id}}');" class="ticket_box fade">
			        		<table>
				        		<tr>
					        		<td class="ticket_left_half">
						        		<img class="profilepic_small" src="{{ user.image }}"><br>
					        		</td>
					        		<td class="ticket_description">
					        			<span class="description">
					        				{{ post.short_description }}
					        			</span>
					        			<span class="hidden_description" style="display:none">
					        				{{post.long_description }}
					        			</span>
						        		<div class="tags">
						        			{% for tag in post.tagnames %}
						        			{{ tag }}
						        			{% endfor %}
						        		</div>
					        		</td>
					        		<td class="ticket_rightview">
					        			<img class="speechbubble" src="{% static 'img/speechbubble.png' %}">
					        			<div class="num_comments">
						        			{{ post.numComments }}
					        			</div>
					        		</td>
				        		</tr>
			        		</table>
			        	</div>

			        	{% endfor %}

			        </div>
				</div>
			</td>
			<td id="right_panel">
				<div id="right_panel_fixed_height">
					<div id="right_panel_content">
						<div id="profilepic_box">
							<img id="profilepic_big" src="{{ user.image }}">
						</div>
						<div id="contact_me">
							{{ user.name }}<br>
							<a href="mailto:{{ user.email }}"><img id="email_img" src="{% static 'img/packet.png' %}"></a>

						</div>

						<div id="short_description">
							{{ relevant_posts.0.short_description }}
						</div>
						<div id="long_description">
							{{ relevant_posts.0.long_description }}
						</div>
						<textarea disabled class="ticket_comment">
							I could probably help with that
						</textarea><br>
						<textarea disabled class="ticket_comment">
							Yeah that sounds cool
						</textarea><br>

						</textarea>

						<form method="post" action="">
							<textarea class="ticket_comment" placeholder="Something to say?" name="comments" cols="25" rows="5"></textarea>
							<br>
							<input class="ticket_submit" type="submit" value="Submit" />
						</form>
					</div>
				</div>
			</td>
		</tr>
	</table>
	<div id="footer">
		<a href="mailto:test@originate.com">questions? comments?</a>
	</div>
</body>

<!-- For Google Plus login -->
<script type="text/javascript">
        (function() {
         var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
         po.src = 'https://apis.google.com/js/client:plusone.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
       })();
 </script>

</html>